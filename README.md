# decoil-viz

Visualize ecDNA reconstruction threads and summarize all the results generated by `decoil`.

- [Getting started using docker](#gettingstarted)
- [Decoil-viz configuration](#decoil-usage)
- [Citation](#citation)
- [License](#license)

## Getting started using docker or singularity <a name="gettingstarted"></a> 

<img src="./decoil-viz.gif" width="600">
<br/>
To run `decoil-viz` you need to have installed [docker](https://docs.docker.com/engine/install/), and have docker engine running, or, [singularity](https://anaconda.org/conda-forge/singularity).

### 1. Install

This image contains all the dependencies needed to run the software.
No additional installation needed.

```commandline
git clone https://github.com/madagiurgiu25/decoil-viz.git
cd decoil-viz
```

To download the docker image:

```
# for docker
./install.sh --docker
```

To download the singularity image:

```
# for singularity
./install.sh --singularity
```

### 2. Run decoil-viz

With docker:

```commandline
decoil-viz --docker --coverage <coverage_file> --summary <summary_file> --reference <reference_file> --gtf <gtf_file> --bed <bed_file> --links <links_file> --outdir <output_directory> --name <output_name>
```

With singularity:

```commandline
decoil-viz --singularity --coverage <coverage_file> --summary <summary_file> --reference <reference_file> --gtf <gtf_file> --bed <bed_file> --links <links_file> --outdir <output_directory> --name <output_name>
```

### 3. Run test example on your machine

0. Create output directory

```commandline
mkdir -p $PWD/example
chmod 777 $PWD/example
```

1. Download test files from [zenodo:10679429](https://zenodo.org/records/10679429)

```commandline
# configure variables
REFERENCE=$PWD/example/GRCh38.primary_assembly.genome.fa
GTF=$PWD/example/gencode.v42.primary_assembly.basic.annotation.gtf
COVERAGE=$PWD/example/coverage.bw
BED=$PWD/example/reconstruct.ecDNA.filtered.bed
LINKS=$PWD/example/reconstruct.links.ecDNA.filtered.txt
SUMMARY=$PWD/example/summary.txt
OUTDIR=$PWD/example
NAME=test

# download example data
wget -O - https://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_human/release_44/GRCh38.primary_assembly.genome.fa.gz | gunzip -c > $REFERENCE
wget -O - https://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_human/release_44/gencode.v44.primary_assembly.basic.annotation.gtf.gz | gunzip -c > $GTF
wget -O - https://zenodo.org/records/10679429/files/coverage.bw > $COVERAGE
wget -O - https://zenodo.org/records/10679429/files/reconstruct.ecDNA.filtered.bed > $BED
wget -O - https://zenodo.org/records/10679429/files/reconstruct.links.ecDNA.filtered.txt > $LINKS
wget -O - https://zenodo.org/records/10679429/files/summary.txt > $SUMMARY

# test your files exist
ls -lthr $REF
ls -lthr $ANNO
ls -lthr $COVERAGE
ls -lthr $BED
ls -lthr $LINKS
ls -lthr $SUMMARY
```

2. Run test example:

With docker

```commandline
bash test_docker.sh
```

With singularity

```commandline
bash test_singularity.sh
```

## Install from source

If you install `decoil-viz` from source, the prequisites are `R>=4.1.1`, `python>=3.7` and `git`.

```
git clone https://github.com/madagiurgiu25/decoil-viz.git
cd decoil-viz
# install R dependencies
Rscript requirements.R

# install decoil-viz
python -m pip install .

# test installation
decoil-viz --help
```

## Decoil-viz configuration <a name="decoil-usage"></a>

Usage:

```commandline
docker run madagiurgiu25/decoil-viz:1.0.0 decoil-viz --help

usage: decoil-viz --outputdir <outputdir> --name <sample> -r <reference-genome> -g <annotation-gtf> --coverage <bw> --summary <summary.txt> --bed <reconstruct.bed> --links <reconstruct.links.txt>

Decoil-viz 1.0.1: visualize ecDNA reconstruction threads + report

optional arguments:
  -h, --help            show this help message and exit
  --version             show program's version number and exit
  -o OUTPUTDIR, --outputdir OUTPUTDIR
  --name NAME           Name of the sample
  --coverage COVERAGE   Coverage file path
  --bed BED             Bed file with reconstructions
  --links LINKS         Links file with reconstructions
  --summary SUMMARY     Summary of reconstructions
  -r REFERENCE_GENOME, --reference-genome REFERENCE_GENOME
                        Reference genome (fasta)
  -g ANNOTATION_GTF, --annotation-gtf ANNOTATION_GTF
                        GTF annotation
  --suffix SUFFIX       Output suffix
  --plot-top PLOT_TOP   Keep only the top x reconstructions (default: 50 -
                        denoting all)
  --plot-filter-score PLOT_FILTER_SCORE
                        Keep reconstructions with estimated_proportions > x
                        (default: 0 - denoting all)
  --plot-window PLOT_WINDOW
                        Keep reconstructions within defined window (path to
                        file in bed format)
  --full FULL           Generate full report
```


## Build environment -  for developers

Build decoil-viz image:

```commandline
docker compose -f docker-compose.yaml build
```

Build the base R 4.1.1 image including all the R dependencies required to run `decoil-viz`:

```commandline
docker compose -f docker-compose-decoil-base_r411.yaml build
```

## Citation <a name="citation"></a>

If you use Decoil for your work please cite our pre-print:

Madalina Giurgiu, Nadine Wittstruck, Elias Rodriguez-Fos, Rocio Chamorro Gonzalez, Lotte Bruckner, Annabell Krienelke-Szymansky, Konstantin Helmsauer, Anne Hartebrodt, Richard P. Koche, Kerstin Haase, Knut Reinert, Anton G. Henssen.
_Decoil: Reconstructing extrachromosomal DNA structural heterogeneity from long-read sequencing data_. bioRxiv, 2023, DOI: [https://doi.org/10.1101/2023.11.15.567169](https://www.biorxiv.org/content/10.1101/2023.11.15.567169v1)

## License <a name="license"></a>

Decoil-viz is distributed under BSD-3-Clause license. See [LICENSE](LICENSE) for details.

### Disclaimer
Decoil-viz and the content of this research-repository (i) is not suitable for a medical device; and (ii) is not intended for clinical use of any kind, including but not limited to diagnosis or prognosis.
